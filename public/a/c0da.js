C0DA=function(){return $.call(C0DA.Object,this,null,C0DA.UUID.generate(0),C0DA.Timestamp.now()),49370},C0DA.go=function(){return C0DA.prototype=$.extend(C0DA.prototype,C0DA.Object.prototype),window.c0da=new C0DA,window.c0da.go()},C0DA.prototype.go=function(){var t=new C0DA.Boot(this).go();return this.parent=this.depot,t},C0DA.NAME="C0DA",C0DA.VERSION="0.3",C0DA.IDENT=C0DA.NAME+" "+C0DA.VERSION,C0DA.Error=function(t){this.desc=t},C0DA.Error.prototype.toString=function(){return this.desc},C0DA.Log=function(t){this.con=t},C0DA.Log.prototype.write=function(t,e){return $.call(this.con[t]||this.con.log,this.con,"["+C0DA.IDENT+"] "+e),e},C0DA.Log.boot=function(){var t=new C0DA.Log(window.console);return t.info("Our bloodline is registered by C0DA."),t},C0DA.Log.prototype.debug=function(t){return this.write("debug",t)},C0DA.Log.prototype.info=function(t){return this.write("log",t)},C0DA.Log.prototype.log=C0DA.Log.prototype.info,C0DA.Log.prototype.warn=function(t){return this.write("warn",t)},C0DA.Log.prototype.error=function(t){return this.write("error",t)},C0DA.UUID=function(t){this.bytes=t},C0DA.UUID.UnpackError=C0DA.Error,C0DA.UUID.generate=function(t){var e="";e+=String.fromCharCode(t);for(var n=0;32>n;n+=2)e+=String.fromCharCode(C0DA.UUID.generateAt(n)<<4|C0DA.UUID.generateAt(n+1));return new C0DA.UUID(e)},C0DA.UUID.parse=function(t){var e=t.match(/^([0-9a-f]{32})\.([0-9a-f]{1,2})$/i),n="";if(!e)throw new C0DA.UUID.UnpackError("UUID has invalid format");n+=String.fromCharCode(parseInt(e[2],16));for(var r=0;r<e[1].length;r+=2)n+=String.fromCharCode(parseInt(e[1].substr(r,2),16));return new C0DA.UUID(n)},C0DA.UUID.from=function(t){return new C0DA.UUID(t)},C0DA.UUID.generateAt=function(t){var e=[3,4,5,6,0,0,0,0,0,0,0,0,2,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],n=[function(){return 16*Math.random()|0},function(){return 3&(16*Math.random()|0)|8},function(){return 4},function(){return 12},function(){return 0},function(){return 13},function(){return 10}];return n[e[t]]()},C0DA.UUID.prototype.toString=function(){return this.bytes},C0DA.UUID.prototype.type=function(){return 127&this.bytes.charCodeAt(0)},C0DA.UUID.prototype.toJSON=function(){return this.unparse()},C0DA.UUID.prototype.unparse=function(){for(var t="",e=1;e<this.bytes.length;e++){var n=this.bytes.charCodeAt(e).toString(16);t+=1==n.length?"0"+n:n}return t+="."+(127&this.bytes.charCodeAt(0)).toString(16)},C0DA.Timestamp=function(t){this.ts=t},C0DA.Timestamp.at=function(t){return"string"===$.type(t)&&(t=parseInt(t)),new C0DA.Timestamp(new Date(t))},C0DA.Timestamp.now=function(){return new C0DA.Timestamp(new Date)},C0DA.Timestamp.prototype.toString=function(){return this.ts.toUTCString()},C0DA.Timestamp.prototype.toJSON=function(){return this.ms()},C0DA.Timestamp.prototype.ms=function(){return this.ts.getTime()},C0DA.Object=function(t,e,n){this.fields={},this.parent=t,this.id=e,this.ts=n},C0DA.Object["new"]=function(t,e,n){return t.unpack(C0DA.UUID.generate(n),C0DA.Timestamp.now())},C0DA.Object.unpackTuple=function(t,e,n){if(!$.isArray(n)||3!==n.length)throw new C0DA.Object.UnpackError("objects must be arrays of length 3");if("string"!==$.type(n[0])||"number"!==$.type(n[1])||!$.isPlainObject(n[2]))throw new C0DA.Object.UnpackError("object is an invalid tuple");return e.build(t.unpack(C0DA.UUID.parse(n[0]),C0DA.Timestamp.at(n[1])),n[2])},C0DA.Object.unpackObject=function(t,e,n){return C0DA.Object.unpackTuple(t,e,[n._id,n._ts,n])},C0DA.Object.unpack=C0DA.Object.unpackTuple,C0DA.Object.prototype.toTuple=function(){return[this.uuid().toJSON(),this.timestamp().toJSON(),this.payload()]},C0DA.Object.prototype.toObject=function(){return $.extend({_id:this.uuid(),_ts:this.timestamp()},this.payload())},C0DA.Object.prototype.toJSON=function(){return this.toTuple()},C0DA.Object.prototype.uuid=function(){return this.id},C0DA.Object.prototype.type=function(){return this.uuid().type()},C0DA.Object.prototype.timestamp=function(){return this.ts},C0DA.Object.prototype.payload=function(t){return t?this.fields[t]:this.fields},C0DA.Object.prototype.p=C0DA.Object.prototype.payload,C0DA.Object.prototype.depot=function(){return this.parent},C0DA.Object.prototype.c0da=function(){return this.depot().c0da()},C0DA.Object.prototype.fire=function(t){var e="on"+t.charAt(0).toUpperCase()+t.slice(1);return $.isFunction(this[e])&&$.call(this[e],this),$.each(this.payload(),function(t,n){$.isFunction(n[e])&&$.call(n[e],n)}),this},C0DA.Object.prototype.onInit=function(){$("body").ensure(this.uuid(),'div[id="'+this.uuid().unparse()+'"]',"div",{id:this.uuid().unparse(),"class":"page jumbotron"},-1),this.c0da().log.debug("object "+this.uuid().unparse()+" initialized")},C0DA.Object.prototype.onFinish=function(){$.uuid(this.uuid()).remove(),$.ownedBy(this.uuid()).remove(),this.c0da().log.debug("object "+this.uuid().unparse()+" finalized")},C0DA.Object.UnpackError=C0DA.Error,C0DA.Mixin=function(){this.fields={}},C0DA.Mixin.prototype.toJSON=C0DA.Object.prototype.payload,C0DA.Mixin.prototype.p=C0DA.Object.prototype.payload,C0DA.Mixin.prototype.payload=C0DA.Object.prototype.payload,C0DA.Depot=function(t){this.parent=t,this.prototypes={},this.cache={},this.types={}},C0DA.Depot.boot=function(t){var e=new C0DA.Depot(t);return e.register(0,C0DA.Object),e},C0DA.Depot.prototype.push=function(t){return $.isArray(t)?t=C0DA.Object.unpackTuple(this.parent.depot,this.parent.registry,t):$.isPlainObject(t)&&(t=C0DA.Object.unpackObject(this.parent.depot,this.parent.registry,t)),this.pop(t.uuid()),this.cache[t.uuid()]=t,this.types[t.uuid().type()][t.uuid()]=t,t.fire("init")},C0DA.Depot.prototype.pop=function(t){this.exists(t)&&(this.cache[t].fire("finish"),delete this.cache[t],delete this.types[t.type()][t])},C0DA.Depot.prototype.exists=function(t){return"string"===$.type(t)&&(t=C0DA.UUID.parse(t)),this.types[t.type()]=this.types[t.type()]||{},t in this.cache},C0DA.Depot.prototype.byType=function(t){return this.types[t]||{}},C0DA.Depot.prototype.byUUID=function(t){return"string"===$.type(t)&&(t=C0DA.UUID.parse(t)),this.cache[t]},C0DA.Depot.prototype.register=function(t,e){if("number"!==$.type(t))throw"key must be a number";return this.prototypes[t]=e,e},C0DA.Depot.prototype.unpack=function(t,e){var n=this.prototypes[t.type()];if(!n)throw new C0DA.Depot.UnpackError("invalid type for UUID "+t.unparse());return new n(this,t,e)},C0DA.Depot.prototype.fire=function(t){$.each(this.cache,function(e,n){n.fire(t)})},C0DA.Depot.prototype.c0da=function(){return this.parent},C0DA.Depot.UnpackError=C0DA.Error,C0DA.Registry=function(t){this.parent=t,this.prototypes={}},C0DA.Registry.boot=function(t){return new C0DA.Registry(t)},C0DA.Registry.prototype.register=function(t,e){if("string"!==$.type(t))throw"key must be a string";return this.prototypes[t]=e,e},C0DA.Registry.prototype.build=function(t,e){var n=this;return $.each(e,function(e,r){if("_"!==e[0]){var i=n.prototypes[e];if(i){var o=new i;o.fields=$.extend({},r),o.parent=function(){return t},r=o}t.fields[e]=r}}),t},C0DA.Registry.prototype.c0da=function(){return this.parent},C0DA.Markdown=function(){this.renderer=new marked.Renderer},C0DA.Markdown.boot=function(){return new C0DA.Markdown},C0DA.Markdown.prototype.parse=function(t){var e=this;return this.deferred=$.Deferred(),marked.parse(t,{renderer:this.renderer,smartypants:!0},function(t,n){t?e.deferred.reject(t):e.deferred.resolve(n)}),this.deferred},C0DA.Page=function(t,e,n){$.call(C0DA.Object,this,t,e,n)},C0DA.Page.prototype=$.extend(C0DA.Page.prototype,C0DA.Object.prototype),C0DA.Page.boot=function(t){t.depot.register(54,C0DA.Page),t.registry.register("meta",C0DA.Page.Meta),t.registry.register("content",C0DA.Page.Content),t.registry.register("style",C0DA.Page.Style),t.registry.register("countdown",C0DA.Page.Countdown)},C0DA.Page.Meta=function(){},C0DA.Page.Meta.prototype=new C0DA.Mixin,C0DA.Page.Meta.prototype.formatAuthors=function(){if(this.p("author")){var t=$("<span />",{"class":"list"}),e=$.isArray(this.p("author"))?this.p("author"):[this.p("author")];return $.each(e,function(n,r){t.append($("<span />",{"class":"name","data-name":r}).html(r)),0==n&&2==e.length?t.append(" & "):n==e.length-2?t.append(", & "):n<e.length-1&&t.append(", ")}),t}return null},C0DA.Page.Meta.prototype.onInit=function(){if($("title").html(this.p("title")===C0DA.NAME?C0DA.NAME:C0DA.NAME+" | "+this.p("title")),$.uuid(this.parent().uuid()).ensure(this.parent().uuid(),".title","h1",{"class":"title"},0).css("display","none").html(this.p("title")).fadeIn(500),this.p("subtitle")){var t=$.isArray(this.p("subtitle"))?this.p("subtitle"):[this.p("subtitle")];$.uuid(this.parent().uuid()).ensure(this.parent().uuid(),".subtitle","h2",{"class":"subtitle"},1).css("display","none").html(t.join("<br />")).fadeIn(500)}if(this.p("author")&&$.uuid(this.parent().uuid()).ensure(this.parent().uuid(),".author","h3",{"class":"author"},2).css("display","none").html(this.formatAuthors()).prepend($("<span />",{"class":"by"}).html("by ")).fadeIn(500),this.p("bg")){var e=$.isArray(this.p("bg"))?this.p("bg"):[this.p("bg")],n=$("body").ensure(this.parent().uuid(),"#bg","div",{id:"bg"},0).empty();$.each(e,function(t,e){n.append($("<img />",{src:e}))}),n.maximage({cycleOptions:{fx:"scrollLeft",speed:1e3,pause:2e3,easing:"easeOutCubic"},onFirstImageLoaded:function(){return n.resize().delay(250).fadeIn(900)},cssBackgroundSize:!0,cssTransitions:!0})}},C0DA.Page.Content=function(){},C0DA.Page.Content.prototype=new C0DA.Mixin,C0DA.Page.Content.prototype.onInit=function(){var t=$.isArray(this.p("md"))?this.p("md"):[this.p("md")],e=$.uuid(this.parent().uuid()).ensure(this.parent().uuid(),".content","div",{"class":"content"},-1).css("display","none"),n=this.parent().c0da().markdown;$.each(t,function(t,r){n.parse(r).done(function(n){e.append($("<div />",{"class":"panel","data-index":t+1}).html(n))})}),e.fadeIn(4e3)},C0DA.Page.Image=function(){},C0DA.Page.Image.prototype=new C0DA.Mixin,C0DA.Page.Image.prototype.onInit=function(){var t=$.isArray(this.p("src"))?this.p("src"):[this.p("src")],e=$.uuid(this.parent().uuid()).ensure(this.parent().uuid(),".image","div",{"class":"image"},-1).css("display","none");$.each(t,function(t,n){var r=($.isArray(n)?n[1]:n)||"",i=$.isArray(n)?n[0]:null,o=null,s=$("<img />",{src:r,"data-index":t+1});i?(o=$("<a />",{href:i,"data-index":t+1}),s.appendTo(o)):o=s,o.appendTo(e)}),e.fadeIn(1e3)},C0DA.Page.Style=function(){},C0DA.Page.Style.prototype=new C0DA.Mixin,C0DA.Page.Style.prototype.onInit=function(){"string"===$.type(this.p("src"))&&$("head").ensure(this.parent().uuid(),'link[rel="stylesheet"][type="text/css"]',"link",{rel:"stylesheet",type:"text/css",href:this.p("src")}),"string"===$.type(this.p("css"))&&$("head").ensure(this.parent().uuid(),'style[type="text/css"]',"style",{type:"text/css"}).html(this.p("css"))},C0DA.Page.Countdown=function(){},C0DA.Page.Countdown.prototype=new C0DA.Mixin,C0DA.Page.Countdown.prototype.remaining=function(){return this.p("target")-C0DA.Timestamp.now().ms()},C0DA.Page.Countdown.prototype.formatRemaining=function(t){t=t||{};var e=Math.max(this.remaining(),0),n=Math.floor(e/864e5);e%=864e5;var r=Math.floor(e/36e5);e%=36e5;var i=Math.floor(e/6e4);e%=6e4;var o=Math.floor(e/1e3);return e%=1e3,[10>n?"0"+n.toString():n.toString(),10>r?"0"+r.toString():r.toString(),10>i?"0"+i.toString():i.toString(),10>o?"0"+o.toString():o.toString()].join(t.colon||":")+(t.decimal||".")+(10>e?"0"+e.toString():e.toString()).substring(0,2)},C0DA.Page.Countdown.prototype.onInit=function(){$.uuid(this.parent().uuid()).ensure(this.parent().uuid(),".countdown","div",{"class":"countdown"},1).ensure(this.parent().uuid(),".timer","div",{"class":"timer"}),this.p("target")>0&&(this.interval=setInterval($.proxy(function(){$.uuid(this.parent().uuid(),".countdown .timer").html(this.formatRemaining())},this),this.p("granularity")||100))},C0DA.Page.Countdown.prototype.onFinish=function(){clearInterval(this.interval)},C0DA.Boot=function(t){this.target=t,this.order=["log","depot","registry","markdown","page"]},C0DA.Boot.prototype.go=function(){var t=function(t){return t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()},e=this;return $.each(this.order,function(n,r){var i=r.split("."),o=C0DA,s=e.target,p=null;$.each(i.slice(0,i.length-1),function(e,n){p=t(n),s[p]=s[p]||function(){},o=o[p],s=s[p]});var a=o[t(i[i.length-1])];if(a&&$.isFunction(a.boot)){var u=a.boot(e.target);u&&(s[i[i.length-1].toLowerCase()]=u)}}),$.Deferred().resolve(this.target).promise()};